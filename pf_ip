grep "Failed password" /var/log/auth.log | awk '{print $(NF-3)}' | sort | uniq -c | sort -rn | awk '$1 > 3 {print $2}' | while read ip; do pfctl -t bruteforce -T add $ip; done

localnet = "{  }"
tcp_services = "{ 22 }"
table <bruteforce> persist
block quick from <bruteforce>
pass in inet proto tcp from any to $localnet port $tcp_services     flags S/SA keep state     (max-src-conn 5, max-src-conn-rate 5/60,     overload <bruteforce> flush global)
